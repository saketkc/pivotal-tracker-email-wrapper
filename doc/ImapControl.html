<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=en_in" />
<title>
  Class: ImapControl
  
    &mdash; Documentation by YARD 0.7.1
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (I)</a> &raquo; 
    
    
    <span class="title">ImapControl</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: ImapControl
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ImapControl</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">main.rb</dd>
  
</dl>
<div class="clear"></div>






  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#build_project_xml-instance_method" title="#build_project_xml (instance method)">- (Object) <strong>build_project_xml</strong>(project_name) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
@params[projectname]= Project Name to create new Project funtion returns
the xml as per Pivotal Tracker &#8220;Add New Project&#8221; API
documentaion.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#build_story_xml-instance_method" title="#build_story_xml (instance method)">- (Object) <strong>build_story_xml</strong>(project_id, story_type, story_name, requested_by, description, owned_by) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
@params[project_id]=Project Id to add story to @params[story_type]=Story
type :feature/bugs/chore @params[story_name]=Story Name/Title
@params[requested_by]=Story Requested by (Takes Username as in Pivotal ,
Email doesnt work) @params[description]=Description of the Story
@params[owned_by]=Story owned by function returns the xml as per Pivotal
Tracker &#8220;Add New Story&#8221; API documentaion.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#imapsync-instance_method" title="#imapsync (instance method)">- (Object) <strong>imapsync</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Function accesses the sccount over IMAP and Checks for new messages New
Messages once read get marked as READ and so won&#8217;t be read the next
time.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (ImapControl) <strong>initialize</strong>(imap_server = 'imap.gmail.com', username = 'slidesharebot@gmail.com', password = '') </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
@params[imap server]= Address of the map server where the bot resides
@params[username]= The username of the bot @params[password]= Password of
the bot.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize_all_projects-instance_method" title="#initialize_all_projects (instance method)">- (Object) <strong>initialize_all_projects</strong>(requester_token) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
@params[requester_token]=Token of the user who has requested a Story
Function fetched all the project Ids..
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#net_http-instance_method" title="#net_http (instance method)">- (Object) <strong>net_http</strong>(uri) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
@params[uri]= Parsed URL function returns a new HTTP/HTTPS connection to
the specified url parameter.
</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="ImapControl (class)">ImapControl</a></span></tt>) <strong>initialize</strong>(imap_server = 'imap.gmail.com', username = 'slidesharebot@gmail.com', password = '') 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
@params[imap server]= Address of the map server where the bot resides
@params[username]= The username of the bot @params[password]= Password of
the bot
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


21
22
23
24
25
26
27
28
29</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'main.rb', line 21</span>

<span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='imap_server identifier id'>imap_server</span><span class='assign token'>=</span><span class='string val'>'imap.gmail.com'</span><span class='comma token'>,</span><span class='username identifier id'>username</span><span class='assign token'>=</span><span class='string val'>'slidesharebot@gmail.com'</span><span class='comma token'>,</span><span class='password identifier id'>password</span><span class='assign token'>=</span><span class='string val'>''</span><span class='rparen token'>)</span>
  <span class='@config ivar id'>@config</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
    <span class='symbol val'>:host</span>     <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;#{imap_server}&quot;</span><span class='comma token'>,</span>
    <span class='symbol val'>:username</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;#{username}&quot;</span><span class='comma token'>,</span>
    <span class='symbol val'>:password</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;#{password}&quot;</span><span class='comma token'>,</span>
    <span class='symbol val'>:port</span>     <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>993</span><span class='comma token'>,</span>
    <span class='symbol val'>:ssl</span>      <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>
  <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="build_project_xml-instance_method">
  
    - (<tt>Object</tt>) <strong>build_project_xml</strong>(project_name) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
@params[projectname]= Project Name to create new Project funtion returns
the xml as per Pivotal Tracker &#8220;Add New Project&#8221; API
documentaion
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


40
41
42</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'main.rb', line 40</span>

<span class='def def kw'>def</span> <span class='build_project_xml identifier id'>build_project_xml</span><span class='lparen token'>(</span><span class='project_name identifier id'>project_name</span><span class='rparen token'>)</span>
  <span class='project_xml identifier id'>project_xml</span><span class='assign token'>=</span><span class='dstring node'>&quot;&lt;project&gt;&lt;name&gt;#{project_name}&lt;/name&gt;&lt;iteration_length type=\&quot;integer\&quot;&gt;2&lt;/iteration_length&gt;&lt;point_scale&gt;0,1,3,9,27&lt;/point_scale&gt;&lt;/project&gt;&quot;</span>  
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="build_story_xml-instance_method">
  
    - (<tt>Object</tt>) <strong>build_story_xml</strong>(project_id, story_type, story_name, requested_by, description, owned_by) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
@params[project_id]=Project Id to add story to @params[story_type]=Story
type :feature/bugs/chore @params[story_name]=Story Name/Title
@params[requested_by]=Story Requested by (Takes Username as in Pivotal ,
Email doesnt work) @params[description]=Description of the Story
@params[owned_by]=Story owned by function returns the xml as per Pivotal
Tracker &#8220;Add New Story&#8221; API documentaion
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


53
54
55</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'main.rb', line 53</span>

<span class='def def kw'>def</span> <span class='build_story_xml identifier id'>build_story_xml</span><span class='lparen token'>(</span><span class='project_id identifier id'>project_id</span><span class='comma token'>,</span><span class='story_type identifier id'>story_type</span><span class='comma token'>,</span><span class='story_name identifier id'>story_name</span><span class='comma token'>,</span><span class='requested_by identifier id'>requested_by</span><span class='comma token'>,</span><span class='description identifier id'>description</span><span class='comma token'>,</span><span class='owned_by identifier id'>owned_by</span><span class='rparen token'>)</span>
  <span class='story_xml identifier id'>story_xml</span><span class='assign token'>=</span><span class='dstring node'>&quot;&lt;story&gt;&lt;story_type&gt;#{story_type}&lt;/story_type&gt;&lt;name&gt;#{story_name}&lt;/name&gt;&lt;requested_by&gt;#{requested_by}&lt;/requested_by&gt;&lt;description&gt;#{description}&lt;/description&gt;&lt;owned_by&gt;#{owned_by}&lt;/owned_by&gt;&lt;/story&gt;&quot;</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="imapsync-instance_method">
  
    - (<tt>Object</tt>) <strong>imapsync</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Function accesses the sccount over IMAP and Checks for new messages New
Messages once read get marked as READ and so won&#8217;t be read the next
time
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'main.rb', line 74</span>

<span class='def def kw'>def</span> <span class='imapsync identifier id'>imapsync</span>
  <span class='@imap ivar id'>@imap</span> <span class='assign token'>=</span> <span class='Net constant id'>Net</span><span class='colon2 op'>::</span><span class='IMAP constant id'>IMAP</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='@config ivar id'>@config</span><span class='lbrack token'>[</span><span class='symbol val'>:host</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='@config ivar id'>@config</span><span class='lbrack token'>[</span><span class='symbol val'>:port</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='@config ivar id'>@config</span><span class='lbrack token'>[</span><span class='symbol val'>:ssl</span><span class='rbrack token'>]</span> <span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='@imap ivar id'>@imap</span><span class='dot token'>.</span><span class='login identifier id'>login</span><span class='lparen token'>(</span> <span class='@config ivar id'>@config</span><span class='lbrack token'>[</span><span class='symbol val'>:username</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='@config ivar id'>@config</span><span class='lbrack token'>[</span><span class='symbol val'>:password</span><span class='rbrack token'>]</span> <span class='rparen token'>)</span>
    <span class='puts identifier id'>puts</span> <span class='string val'>&quot;Connected&quot;</span>
  <span class='else else kw'>else</span>
    <span class='raise identifier id'>raise</span><span class='lparen token'>(</span><span class='string val'>&quot;Connection Failed&quot;</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  
  <span class='@imap ivar id'>@imap</span><span class='dot token'>.</span><span class='select identifier id'>select</span><span class='lparen token'>(</span><span class='string val'>'INBOX'</span><span class='rparen token'>)</span> <span class='comment val'>#Select INBOX from the gmail account to look for new messages</span>
  <span class='project identifier id'>project</span><span class='assign token'>=</span><span class='string val'>&quot;&quot;</span>
  <span class='attrs identifier id'>attrs</span><span class='assign token'>=</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='@imap ivar id'>@imap</span><span class='dot token'>.</span><span class='search identifier id'>search</span><span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='string val'>&quot;NOT&quot;</span><span class='comma token'>,</span><span class='string val'>&quot;SEEN&quot;</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='message_id identifier id'>message_id</span><span class='bitor op'>|</span> <span class='comment val'># Look for UNREAD MESSAGES</span>
    <span class='@mailbox ivar id'>@mailbox</span> <span class='assign token'>=</span> <span class='@imap ivar id'>@imap</span><span class='dot token'>.</span><span class='fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='message_id identifier id'>message_id</span><span class='comma token'>,</span> <span class='string val'>'ENVELOPE'</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='attr identifier id'>attr</span><span class='lbrack token'>[</span><span class='string val'>'ENVELOPE'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to identifier id'>to</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='mailbox identifier id'>mailbox</span> <span class='comment val'>#Fetch the unread email</span>
    <span class='@mailbox ivar id'>@mailbox</span> <span class='assign token'>=</span> <span class='@mailbox ivar id'>@mailbox</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='regexp val'>/([_\-\.])+/</span><span class='comma token'>,</span> <span class='string val'>' '</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='downcase identifier id'>downcase</span>
    <span class='@mailbox ivar id'>@mailbox</span><span class='dot token'>.</span><span class='gsub! fid id'>gsub!</span><span class='lparen token'>(</span><span class='regexp val'>/\b([a-z])/</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='$1 nth_ref id'>$1</span><span class='dot token'>.</span><span class='capitalize identifier id'>capitalize</span> <span class='rbrace token'>}</span>
    <span class='@msg ivar id'>@msg</span> <span class='assign token'>=</span> <span class='@imap ivar id'>@imap</span><span class='dot token'>.</span><span class='fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='message_id identifier id'>message_id</span><span class='comma token'>,</span><span class='string val'>'RFC822'</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='attr identifier id'>attr</span><span class='lbrack token'>[</span><span class='string val'>'RFC822'</span><span class='rbrack token'>]</span>
    <span class='email identifier id'>email</span> <span class='assign token'>=</span>  <span class='TMail constant id'>TMail</span><span class='colon2 op'>::</span><span class='Mail constant id'>Mail</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='@msg ivar id'>@msg</span><span class='rparen token'>)</span> <span class='comment val'>#Use TMail Library to parse the email message</span>
    <span class='raise identifier id'>raise</span> <span class='string val'>&quot;Subject Empty&quot;</span> <span class='if if_mod kw'>if</span> <span class='email identifier id'>email</span><span class='dot token'>.</span><span class='subject identifier id'>subject</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>  <span class='comment val'>#Raise Error in case &quot;Subject&quot; is empty</span>
    <span class='@email_subject ivar id'>@email_subject</span><span class='assign token'>=</span><span class='email identifier id'>email</span><span class='dot token'>.</span><span class='subject identifier id'>subject</span>       <span class='comment val'>#Subject of the Email          </span>
          <span class='@email_subject ivar id'>@email_subject</span><span class='assign token'>=</span><span class='@email ivar id'>@email</span><span class='dot token'>.</span><span class='subject identifier id'>subject</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='string val'>&quot;[&quot;</span><span class='comma token'>,</span><span class='string val'>&quot;&quot;</span><span class='rparen token'>)</span> <span class='comment val'>#The Format of the Sunject should be [ProjectName][Story Type][Story Title]</span>
    <span class='@split_subject ivar id'>@split_subject</span><span class='assign token'>=</span><span class='@email_subject ivar id'>@email_subject</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;]&quot;</span><span class='rparen token'>)</span> 
    <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:project</span><span class='rbrack token'>]</span><span class='assign token'>=</span><span class='@split_subject ivar id'>@split_subject</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='regexp val'>/ /</span><span class='comma token'>,</span><span class='string val'>&quot;&quot;</span><span class='rparen token'>)</span> <span class='comment val'>#Project Name</span>
    <span class='if if kw'>if</span> <span class='@split_subject ivar id'>@split_subject</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> 
    <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:story_title</span><span class='rbrack token'>]</span><span class='assign token'>=</span><span class='string val'>&quot;feature&quot;</span>  <span class='comment val'># intialise the Story Type as &quot;feature&quot; in case this column is empty</span>
    <span class='else else kw'>else</span> <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:story_type</span><span class='rbrack token'>]</span><span class='assign token'>=</span><span class='@split_subject ivar id'>@split_subject</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='regexp val'>/ /</span><span class='comma token'>,</span><span class='string val'>&quot;&quot;</span><span class='rparen token'>)</span> <span class='comment val'>#Else intialize the story Type</span>
    <span class='end end kw'>end</span>
    <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:requested_by_email</span><span class='rbrack token'>]</span><span class='assign token'>=</span> <span class='email identifier id'>email</span><span class='dot token'>.</span><span class='from identifier id'>from</span> <span class='comment val'>#Requested By</span>
    <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:story_title</span><span class='rbrack token'>]</span><span class='assign token'>=</span><span class='@split_subject ivar id'>@split_subject</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='regexp val'>/ /</span><span class='comma token'>,</span><span class='string val'>&quot;&quot;</span><span class='rparen token'>)</span> <span class='comment val'>#Story Titile</span>
    <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='email identifier id'>email</span><span class='dot token'>.</span><span class='cc identifier id'>cc</span> 
      <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:cc</span><span class='rbrack token'>]</span><span class='assign token'>=</span><span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:requested_by_email</span><span class='rbrack token'>]</span>  <span class='comment val'>#Incase theres is no person CCed the project should get assigned to the requester of the story himself</span>
    <span class='else else kw'>else</span>
      <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:cc</span><span class='rbrack token'>]</span><span class='assign token'>=</span>  <span class='email identifier id'>email</span><span class='dot token'>.</span><span class='cc identifier id'>cc</span> 
    <span class='end end kw'>end</span>
    <span class='email_body identifier id'>email_body</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='email identifier id'>email</span><span class='dot token'>.</span><span class='body identifier id'>body</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='regexp val'>/[\r]+/</span><span class='comma token'>,</span><span class='string val'>&quot; &quot;</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:body</span><span class='rbrack token'>]</span><span class='assign token'>=</span><span class='email_body identifier id'>email_body</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='regexp val'>/[\n]+/</span><span class='comma token'>,</span><span class='string val'>&quot; &quot;</span><span class='rparen token'>)</span>
    <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:body</span><span class='rbrack token'>]</span><span class='assign token'>=</span><span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:body</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='unpack identifier id'>unpack</span><span class='lparen token'>(</span><span class='string val'>'M*'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span><span class='dot token'>.</span><span class='first identifier id'>first</span> <span class='comment val'>#To support Multipart Data.</span>
    <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:owned_by</span><span class='rbrack token'>]</span><span class='assign token'>=</span><span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:cc</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='comment val'>#Owner of the Story is the person who was CCed</span>
    
    
    <span class='comment val'>####START CREATING STORIES IN PROJECTS###</span>
    <span class='initialize_all_projects identifier id'>initialize_all_projects</span><span class='lparen token'>(</span><span class='$TOKEN gvar id'>$TOKEN</span><span class='lbrack token'>[</span><span class='dstring node'>&quot;#{attrs[:requested_by_email]}&quot;</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>&quot;token&quot;</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>    <span class='comment val'>#Fetch the Project Ids vs Project Names from Pivotal</span>
    <span class='@project_id ivar id'>@project_id</span><span class='assign token'>=</span> <span class='@projects_on_pivotal ivar id'>@projects_on_pivotal</span><span class='lbrack token'>[</span><span class='dstring node'>&quot;#{attrs[:project]}&quot;</span><span class='rbrack token'>]</span> <span class='comment val'>#Get the Corresponding Project Id as per the name in the Email Subhect</span>
     <span class='@story_type ivar id'>@story_type</span><span class='assign token'>=</span><span class='dstring node'>&quot;#{attrs[:story_type]}&quot;</span><span class='dot token'>.</span><span class='downcase identifier id'>downcase</span> <span class='comment val'>#The Story Type(feature/bug/chores)</span>
     <span class='@story_name ivar id'>@story_name</span><span class='assign token'>=</span><span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:story_title</span><span class='rbrack token'>]</span> <span class='comment val'>#Story Name/Title</span>
     <span class='@token ivar id'>@token</span><span class='assign token'>=</span><span class='$TOKEN gvar id'>$TOKEN</span><span class='lbrack token'>[</span><span class='dstring node'>&quot;#{attrs[:requested_by_email]}&quot;</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>&quot;token&quot;</span><span class='rbrack token'>]</span> <span class='div op'>/</span><span class='comment val'>#The token of the Requester</span>
     <span class='@assigned_by ivar id'>@assigned_by</span><span class='assign token'>=</span><span class='$TOKEN gvar id'>$TOKEN</span><span class='lbrack token'>[</span><span class='dstring node'>&quot;#{attrs[:requested_by_email]}&quot;</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>&quot;username&quot;</span><span class='rbrack token'>]</span> <span class='comment val'>#Pivotal Username of the Requester</span>
     <span class='@description ivar id'>@description</span><span class='assign token'>=</span><span class='dstring node'>&quot;#{attrs[:body]}&quot;</span> <span class='comment val'>#Description of the story</span>
     <span class='@owned_by ivar id'>@owned_by</span><span class='assign token'>=</span><span class='$TOKEN gvar id'>$TOKEN</span><span class='lbrack token'>[</span><span class='dstring node'>&quot;#{attrs[:owned_by]}&quot;</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>&quot;username&quot;</span><span class='rbrack token'>]</span> <span class='comment val'>#Pivotal Username of the Owner</span>
     <span class='@base_url ivar id'>@base_url</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;http://www.pivotaltracker.com:80/services/v3/projects/#{@project_id}/stories&quot;</span>
     <span class='resource_uri identifier id'>resource_uri</span> <span class='assign token'>=</span> <span class='URI constant id'>URI</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{@base_url}&quot;</span><span class='rparen token'>)</span>
     <span class='story_xml identifier id'>story_xml</span><span class='assign token'>=</span><span class='build_story_xml identifier id'>build_story_xml</span><span class='lparen token'>(</span><span class='@project_id ivar id'>@project_id</span><span class='comma token'>,</span><span class='@story_type ivar id'>@story_type</span><span class='comma token'>,</span><span class='@story_name ivar id'>@story_name</span><span class='comma token'>,</span><span class='@assigned_by ivar id'>@assigned_by</span><span class='comma token'>,</span><span class='@description ivar id'>@description</span><span class='comma token'>,</span><span class='@owned_by ivar id'>@owned_by</span><span class='rparen token'>)</span><span class='comment val'>#Get the XML to Add New Story</span>
     <span class='response identifier id'>response</span> <span class='assign token'>=</span> <span class='net_http identifier id'>net_http</span><span class='lparen token'>(</span><span class='resource_uri identifier id'>resource_uri</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='start identifier id'>start</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='http identifier id'>http</span><span class='bitor op'>|</span>
      <span class='http identifier id'>http</span><span class='dot token'>.</span><span class='post identifier id'>post</span><span class='lparen token'>(</span><span class='resource_uri identifier id'>resource_uri</span><span class='dot token'>.</span><span class='path identifier id'>path</span><span class='comma token'>,</span> <span class='story_xml identifier id'>story_xml</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='string val'>'X-TrackerToken'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='@token ivar id'>@token</span><span class='comma token'>,</span> <span class='string val'>'Content-Type'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'application/xml'</span><span class='rbrace token'>}</span><span class='rparen token'>)</span> <span class='comment val'>#POST the parameters to Add New STory</span>
    <span class='end end kw'>end</span>
 
  <span class='end end kw'>end</span>
    <span class='@imap ivar id'>@imap</span><span class='dot token'>.</span><span class='logout identifier id'>logout</span> <span class='comment val'>#Logout</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="initialize_all_projects-instance_method">
  
    - (<tt>Object</tt>) <strong>initialize_all_projects</strong>(requester_token) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
@params[requester_token]=Token of the user who has requested a Story
Function fetched all the project Ids..
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


60
61
62
63
64
65
66
67
68
69
70</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'main.rb', line 60</span>

<span class='def def kw'>def</span> <span class='initialize_all_projects identifier id'>initialize_all_projects</span> <span class='lparen token'>(</span><span class='requester_token identifier id'>requester_token</span><span class='rparen token'>)</span>
  <span class='base_url identifier id'>base_url</span> <span class='assign token'>=</span> <span class='string val'>&quot;http://www.pivotaltracker.com:80/services/v3/projects/&quot;</span> <span class='comment val'>#Base URL for fetching the Project IDs</span>
  <span class='resource_uri identifier id'>resource_uri</span> <span class='assign token'>=</span> <span class='URI constant id'>URI</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{base_url}&quot;</span><span class='rparen token'>)</span> <span class='comment val'>#URI Parse the base url</span>
  <span class='response identifier id'>response</span> <span class='assign token'>=</span> <span class='net_http identifier id'>net_http</span><span class='lparen token'>(</span><span class='resource_uri identifier id'>resource_uri</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='start identifier id'>start</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='http identifier id'>http</span><span class='bitor op'>|</span>
    <span class='http identifier id'>http</span><span class='dot token'>.</span><span class='get identifier id'>get</span><span class='lparen token'>(</span><span class='resource_uri identifier id'>resource_uri</span><span class='dot token'>.</span><span class='path identifier id'>path</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='string val'>'X-TrackerToken'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;#{token}&quot;</span><span class='rbrace token'>}</span><span class='rparen token'>)</span> <span class='comment val'>#Send a get response to fetch all the Project Ids as an XML response</span>
  <span class='end end kw'>end</span>
  <span class='data identifier id'>data</span> <span class='assign token'>=</span> <span class='XmlSimple constant id'>XmlSimple</span><span class='dot token'>.</span><span class='xml_in identifier id'>xml_in</span><span class='lparen token'>(</span><span class='response identifier id'>response</span><span class='dot token'>.</span><span class='body identifier id'>body</span><span class='rparen token'>)</span> <span class='comment val'>#The response needs to be parsed</span>
  <span class='data identifier id'>data</span><span class='lbrack token'>[</span><span class='string val'>'project'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='p identifier id'>p</span><span class='bitor op'>|</span> <span class='comment val'>#Search for all &quot;project&quot; nodes in the document</span>
    <span class='@projects_on_pivotal ivar id'>@projects_on_pivotal</span><span class='lbrack token'>[</span><span class='dstring node'>&quot;#{p['name']}&quot;</span><span class='rbrack token'>]</span><span class='assign token'>=</span><span class='dstring node'>&quot;#{p['id']}&quot;</span> <span class='comment val'># Intialise the project ids corresponding to the project names</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="net_http-instance_method">
  
    - (<tt>Object</tt>) <strong>net_http</strong>(uri) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
@params[uri]= Parsed URL function returns a new HTTP/HTTPS connection to
the specified url parameter
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


33
34
35
36</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'main.rb', line 33</span>

<span class='def def kw'>def</span> <span class='net_http identifier id'>net_http</span><span class='lparen token'>(</span><span class='uri identifier id'>uri</span><span class='rparen token'>)</span>
  <span class='h identifier id'>h</span> <span class='assign token'>=</span> <span class='Net constant id'>Net</span><span class='colon2 op'>::</span><span class='HTTP constant id'>HTTP</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='uri identifier id'>uri</span><span class='dot token'>.</span><span class='host identifier id'>host</span><span class='comma token'>,</span> <span class='uri identifier id'>uri</span><span class='dot token'>.</span><span class='port identifier id'>port</span><span class='rparen token'>)</span>
  <span class='h identifier id'>h</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Sun May 29 19:42:59 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.1 (ruby-1.8.7).
</div>

  </body>
</html>